
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Habilidad 2: De la Distracción a la Conciencia</title>
    <link rel="stylesheet" href="static/styles/habilidad.css">
</head>

<header>
    <div class="header-container">
        <div class="logo-container">
            <a href="index.html">
                <img src="static/imagenes/logo.jpeg" alt="Logo SerenaMente IA" class="logo">
            </a>
        </div>
        <button class="menu-toggle" aria-label="Toggle Menu">&#9776;</button>
        <nav class="submenu">
            <ul>
                <li><a href="actividades.html">Mis actividades</a></li>
                <li><a href="progreso.html">Mi progreso</a></li>
                <div class="user-menu">
                    <div id="user-avatar" class="avatar">US</div>
                    <div id="user-dropdown" class="dropdown-menu">
                        <a href="perfil.html">Ver perfil</a>
                        <a href="#" id="logout">Cerrar sesión</a>
                    </div>
                </div>                        
            </ul>
        </nav>
    </div>
</header>
<main>
    <div class="container">
        <h1>Habilidad 2: De la Distracción a la Conciencia</h1>
            <div style="display: flex; align-items: flex-start; gap: 20px;">
                <img src="static/imagenes/image3.jpg" alt="Descripción de la imagen" style="height: 100%; max-height: 300px; width: auto; object-fit: cover;">
                <div style="flex: 1;">
                    <p> ¡Hola! Te doy la bienvenida a esta nueva habilidad que te permitirá lograr una mayor conciencia!<br>
                        Aprenderás a reconocer tu mente en movimiento y anclar tu atención en el momento presente. </p> 
                        <br>En esta habilidad aprenderás a reconocer tu mente en movimiento y anclar tu atención en el momento presente. Vamos a explorar cómo nuestra atención se mueve de un lugar a otro, la mayoría de las veces, sin darnos cuenta.
                        <div class="recuerda-box">
                            <img src="static/imagenes/recuerda.jpeg" alt="Koala recuerda" class="koala-img">
                            <p>¿Alguna vez has sentido que tu mente está en todas partes menos en lo que estás haciendo en el presente? ¿De pronto te has sorprendido por la aparición de un recuerdo o algún tipo de pensamiento?.</p>
                        </div>
                        <p> Esto es algo común. Me gustaría que veamos cómo tu mente salta entre pensamientos y cómo guiarla con amabilidad. También, cómo la atención y los hábitos mentales se relacionan con el estrés, y la importancia de cuestionar los juicios y sesgos para lograr estabilidad.
                        </p>
                </div>
            </div>
            <div class="recuerda-box">
                <img src="static/imagenes/recuerda.jpeg" alt="Koala recuerda" class="koala-img">
                <p><strong>Recuerda:</strong> Mindfulness no significa dejar de pensar, sino notar en qué estás pensando, qué está pasando en tu cuerpo y traer tu atención de vuelta al presente con curiosidad y amabilidad
                    .</p>
            </div>
    <p>Para esto, revisa este video que te explica sobre cómo la mente divaga y su relación con el estrés y otros estados de ánimo </p>


        <div class="video-container">
            <video controls>
                <source src="static/videos/G_Video D1.mp4" type="video/mp4">
                Tu navegador no soporta la reproducción de videos.
            </video>
            <p> Ahora que conoces más sobre la naturaleza divagante de tu mente, comienza a entrenarte en ir de la distracción a la conciencia. ¿Iniciamos?
            </p>
        </div>

            <div class="button-container">
                <button onclick="startExperience()">Sí, tengo todo preparado para iniciar</button>
                <button onclick="postponeExperience()">No, quisiera empezar después</button>
            </div>
            
            <div id="activities-menu">
                <div class="serenito">
                    <div class="speech-bubble">Selecciona la actividad para comenzar</div>
                    <img src="static/imagenes/serenito.png" alt="Serenito">
                </div>
                <div class="activities">
                    <!-- Actividad 1  -->
                    <div class="activity">
                        <div class="activity-card" id="activity1" onclick="unlockActivity(2)">
                            <p>1. Meditación para Ver </p>
                            <a href="actividad21.html">
                                <button> 
                                    <img src="static/imagenes/boton21.png" alt="Actividad 1">
                                </button>
                            </a>
                        </div>
                    </div>
                    
                    <!-- Actividad 2 -->
                    <div class="activity">
                        <div class="activity-card disabled" id="activity2" onclick="unlockActivity(3)">
                            <p>2. Aceptación y No Juicio</p>
                            <a href="actividad22.html">
                                <button disabled>
                                    <img src="static/imagenes/boton22.png" alt="Actividad 2">
                                </button>
                            </a>
                        </div>
                    </div>
            
                    <!-- Actividad 3  -->
                    <div class="activity">
                        <div class="activity-card disabled" id="activity3">
                            <p>3. Práctica Breve de Yoga </p>
                            <a href="actividad23.html">
                                <button disabled>
                                    <img src="static/imagenes/boton23.png" alt="Actividad 3">
                                </button>
                            </a>
                        </div>
                    </div>
                    <!-- Actividad 4 -->
                    <div class="activity">
                        <div class="activity-card disabled" id="activity3">
                            <p>3. Escaneo Corporal </p>
                            <a href="actividad24.html">
                                <button disabled>
                                    <img src="static/imagenes/boton24.png" alt="Actividad 4">
                                </button>
                            </a>
                        </div>
                    </div>
        </div>
    </div>
</main>
<div class="social-bar">
    <a href="https://www.facebook.com/SerenaMenteUNAM?_rdc=1&_rdr#" target="_blank" class="social-icon">
        <img src="static/imagenes/Logo_facebook.png" alt="Facebook">
    </a>
    <a href="https://www.instagram.com/serenamente_app/?igshid=YTQwZjQ0NmI0OA%3D%3D" target="_blank" class="social-icon">
        <img src="static/imagenes/Logo_instagram.png" alt="Instagram">
    </a>
    <a href="https://www.youtube.com/@SerenaMente-xk7tm" target="_blank" class="social-icon">
        <img src="static/imagenes/Logo_youtube.png" alt="YouTube">
    </a>

</div>

<!--Banner con logos-->
<div class="banner-section">
    <div class="banner-logo">
        <img src="static/imagenes/LOGO.png" alt="Logo SerenaMente">
    </div>
    <div class="banner-text">
        <p>Cuenta con el respaldo y colaboración de investigadores e investigadoras de las siguientes instituciones.</p>
    </div>
    <div class="banner-logos">
        <a href="https://www.unam.mx">
            <img src="static/imagenes/Logo1.png" alt="Logo UNAM">
        </a>
        <a href="https://suayed.iztacala.unam.mx/">
            <img src="static/imagenes/Logo2.png" alt="Logo SUAYED">
        </a>
        <a href="https://labpsiit.iztacala.unam.mx/">
            <img src="static/imagenes/Logo3.png" alt="Logo LABPSITT">
        </a>
        <a href="https://www.ipn.mx/">
            <img src="static/imagenes/Logo4.png" alt="Logo IPN">
        </a>
        <a href="https://www.escom.ipn.mx/">
            <img src="static/imagenes/Logo5.png" alt="Logo ESCOM">
        </a>
    </div>
</div>

<!-- Footer -->
<footer>
    <div class="footer-container">
        <div class="footer-text">
            <h3>¿Tienes dudas?</h3>
            <p>Si tienes más preguntas o dudas sobre cualquier tema, puedes contactarnos y seguro te responderemos.</p>
        </div>
        <div class="footer-buttons">
            <a href="mailto:serenamente@iztacala.unam.mx" class="footer-btn">Correo electrónico</a>
            <a href="avisoprivacidad.html" class="footer-btn">Aviso de Privacidad</a>
        </div>
    </div>
</footer>

<script>
    // Funcion para el menu de hamburguesa
    const menuToggle = document.querySelector('.menu-toggle');
    const submenu = document.querySelector('.submenu');

    menuToggle.addEventListener('click', () => {
        submenu.classList.toggle('active'); // Alterna la clase 'active' para mostrar/ocultar el menú
    });

    // Funcion que verifica el token y si se contesto el pretest
    async function verificarAutenticacion() {
        const token = localStorage.getItem("token");
        if (!token) {
            window.location.href = "login.html";
            return;
        }

        try {
            const response = await fetch("http://localhost:8002/auth/verify-token", {
                method: "GET",
                headers: { "Authorization": `Bearer ${token}` }
            });

            if (!response.ok) {
                console.error("Error en la autenticación:", await response.json());
                localStorage.removeItem("token");
                window.location.href = "login.html";
                return;
            }

            const userData = await response.json();
            const initials = userData.usuario.nombre
            .split(" ")
            .map(word => word[0])
            .join("")
            .toUpperCase();
            document.getElementById("user-avatar").textContent = initials;
        } catch (error) {
            console.error("Error en la autenticación:", error);
            window.location.href = "login.html";
        }
    }

    document.addEventListener("DOMContentLoaded", function () {
        const avatar = document.getElementById("user-avatar");
        const userMenu = document.querySelector(".user-menu");

        avatar.addEventListener("click", function () {
            userMenu.classList.toggle("active");
        });

        document.getElementById("logout").addEventListener("click", function () {
            localStorage.removeItem("token");
            window.location.href = "login.html";
    });

    verificarAutenticacion();
});

//funcion de botones 
function startExperience() {
    document.getElementById('activities-menu').classList.remove('hidden');
    document.querySelector('.button-container').classList.add('hidden');
}
    function postponeExperience() {
        alert('Puedes volver cuando estés listo');
        document.querySelector('.button-container').classList.add('hidden');
    }

    function startExperience() {
        document.getElementById('activities-menu').style.display = 'flex';
        document.querySelector('.button-container').style.display = 'none';
}

// Funcionalidad para extraer el id del token 
function getTokenId() {
    const token = localStorage.getItem("token");
    if (token) {
        try {
            const base64Url = token.split('.')[1]; // obtiene la parte de carga del JWT
            const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));

            const { id } = JSON.parse(jsonPayload);
            return id;
        } catch (error) {
            console.error("Error decoding token:", error);
            return null;
        }
    }
    return null;
}

// Lógica principal: desbloquea SOLO la actividad actual
document.addEventListener("DOMContentLoaded", async function () {
    const token = localStorage.getItem("token");
    if (!token) {
        window.location.href = "login.html";
        return;
    }

    const paciente_id = getTokenId();

    // Obtener tratamiento actual del paciente
    const tratamientoResponse = await fetch(`http://localhost:8002/tratamiento/buscar_protocolo/${paciente_id}`);
    const tratamientoData = await tratamientoResponse.json();
    const tratamiento_id = tratamientoData.id_tratamiento;

    // ID de la habilidad (puede estar fijo o dinámico según el contexto)
    const habilidad_id = 3;

    // Obtener actividades relacionadas con la habilidad
    const actividadesResponse = await fetch(`http://localhost:8002/tratamiento/ruta_actividad/${tratamiento_id}/habilidad/${habilidad_id}`);
    const actividades = await actividadesResponse.json();
    
    // Obtener la actividad actual del paciente
    const progresoResponse = await fetch(`http://localhost:8002/tratamiento/progreso/actividad_actual/${paciente_id}`);
    const progresoData = await progresoResponse.json();
    const actividadActualId = progresoData.id_actividad_actual;

    // Limpiar y mostrar actividades
    const activitiesContainer = document.querySelector(".activities");
    activitiesContainer.innerHTML = "";

    actividades.forEach((actividad, index) => {
        const activityDiv = document.createElement("div");
        activityDiv.classList.add("activity");

        const cardDiv = document.createElement("div");
        cardDiv.classList.add("activity-card");
        cardDiv.id = `activity${index + 1}`;

        const estaDesbloqueada = actividad.id_actividad === actividadActualId;

        if (actividad.id_actividad < actividadActualId) {
            cardDiv.classList.add("completada");
        } else if (actividad.id_actividad === actividadActualId) {
            // actividad actual – desbloqueada
        } else {
            cardDiv.classList.add("disabled");
        }

        cardDiv.innerHTML = `
            <p>${index + 1}. ${actividad.nombre}</p>
            <a href="actividad${actividad.id_actividad}.html">
                <button ${actividad.id_actividad > actividadActualId ? "disabled" : ""}>
                    <img src="static/imagenes/boton${habilidad_id}${index + 1}.png" alt="actividad${habilidad_id}${index + 1}">
                </button>
            </a>
        `;

        activityDiv.appendChild(cardDiv);
        activitiesContainer.appendChild(activityDiv);
    });
});
</script>
</body>
</html>


