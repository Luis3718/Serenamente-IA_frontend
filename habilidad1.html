<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Habilidad: Comenzar a trabajar en mí</title>
    <link rel="stylesheet" href="static/styles/habilidad.css">
</head>
<body>
    <!-- Submenú y logo-->
    <header>
        <div class="header-container">
            <div class="logo-container">
                <a href="dashboard.html">
                    <img src="static/imagenes/logo.jpg" alt="Logo SerenaMente IA" class="logo">
                </a>
            </div>
            <button class="menu-toggle" aria-label="Toggle Menu">&#9776;</button>
            <nav class="submenu">
                <ul>
                    <li><a href="actividades.html">Mis actividades</a></li>
                    <li><a href="progreso.html">Mi progreso</a></li>
                    <div class="user-menu">
                        <div id="user-avatar" class="avatar">US</div>
                        <div id="user-dropdown" class="dropdown-menu">
                            <a href="perfil.html">Ver perfil</a>
                            <a href="#" id="logout">Cerrar sesión</a>
                        </div>
                    </div>                        
                </ul>
            </nav>
        </div>
    </header>


    <!-- Contenido principal -->
    <main>
        <div class="container">
            <h1>Habilidad: 0 Comenzar a trabajar en mí</h1>
            <div style="display: flex; align-items: flex-start; gap: 20px;">
                <img src="static/imagenes/image0.jpeg" alt="Descripción de la imagen" style="height: 100%; max-height: 300px; width: auto; object-fit: cover;">
                <div style="flex: 1;">
                    <p>Hola, te doy la bienvenida a los primeros pasos en este camino hacia el autodescubrimiento.</p>
                    <p>Antes de comenzar, es importante que conozcas lo que puedes esperar de esta experiencia, aclarar algunos conceptos clave relacionados con SerenaMente IA y con el mindfulness para que tengas una comprensión clara de lo que implica este programa y sobre todo, que sepas que uno de los puntos más importantes es que esta experiencia te ofrece la integración de Inteligencia Artificial (IA) para personalizar tu proceso de aprendizaje y práctica.</p>
                    <p>Recuerda que para generar cambios en la vida, lo más importante es comenzar, y tú ya estás dando ese primer paso.</p>
                       </div>
            </div>
            
            <p>Revisa el siguiente video</p>
             
           
        <div class="video-container">
            <video controls>
                <source src="static/videos/G_Video B1.mp4" type="video/mp4">
                Tu navegador no soporta la reproducción de videos.
            </video>
        </div>
        
        <p> Como viste en el video, incorporar mindfulness en conjunto con Inteligencia Artificial (IA) en la vida es algo realmente positivo, por lo que aquí te iré guiando en diferentes prácticas en un espacio de seguridad y confianza, para que puedas sentir comodidad en tu exploración. También te mostraré cómo están estructuradas las actividades para que sepas qué esperar a lo largo de las semanas. ¡Vamos a comenzar!</p>
        
        <div class="button-container">
            <button onclick="startExperience()">Sí, tengo todo preparado para iniciar</button>
            <button onclick="postponeExperience()">No, quisiera empezar después</button>
        </div>
        
        <div id="activities-menu">
            <div class="serenito">
                <div class="speech-bubble">Selecciona la actividad para comenzar</div>
                <img src="static/imagenes/serenito.png" alt="Serenito">
            </div>
            <div class="activities">
                <!-- Actividad 1 (Disponible desde el inicio) -->
                <div class="activity">
                    <div class="activity-card" id="activity1" onclick="unlockActivity(2)">
                        <p>1. Qué es mindfulness y cómo puede ayudarme</p>
                        <a href="actividad1.html">
                            <button> 
                                <img src="static/imagenes/boton01.png" alt="Actividad 1">
                            </button>
                        </a>
                    </div>
                </div>
                
                <!-- Actividad 2 (Bloqueada hasta que se haga clic en la primera) -->
                <div class="activity">
                    <div class="activity-card disabled" id="activity2" onclick="unlockActivity(3)">
                        <p>2. Ya sé qué es mindfulness, ¿qué sigue?</p>
                        <a href="actividad2.html">
                            <button disabled>
                                <img src="static/imagenes/boton02.png" alt="Actividad 2">
                            </button>
                        </a>
                    </div>
                </div>
        
                <!-- Actividad 3 (Bloqueada hasta que se haga clic en la segunda) -->
                <div class="activity">
                    <div class="activity-card disabled" id="activity3">
                        <p>3. Respiración Consciente</p>
                        <a href="actividad3.html">
                            <button disabled>
                                <img src="static/imagenes/boton03.png" alt="Actividad 3">
                            </button>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        
        
    </main>

    <div class="social-bar">
        <a href="https://www.facebook.com/SerenaMenteUNAM?_rdc=1&_rdr#" target="_blank" class="social-icon">
            <img src="static/imagenes/Logo_facebook.png" alt="Facebook">
        </a>
        <a href="https://www.instagram.com/serenamente_app/?igshid=YTQwZjQ0NmI0OA%3D%3D" target="_blank" class="social-icon">
            <img src="static/imagenes/Logo_instagram.png" alt="Instagram">
        </a>
        <a href="https://www.youtube.com/@SerenaMente-xk7tm" target="_blank" class="social-icon">
            <img src="static/imagenes/Logo_youtube.png" alt="YouTube">
        </a>
   
    </div>
    
    <!--Banner con logos-->
    <div class="banner-section">
        <div class="banner-logo">
            <img src="static/imagenes/LOGO.png" alt="Logo SerenaMente">
        </div>
        <div class="banner-text">
            <p>Cuenta con el respaldo y colaboración de investigadores e investigadoras de las siguientes instituciones.</p>
        </div>
        <div class="banner-logos">
            <a href="https://www.unam.mx">
                <img src="static/imagenes/Logo1.png" alt="Logo UNAM">
            </a>
            <a href="https://suayed.iztacala.unam.mx/">
                <img src="static/imagenes/Logo2.png" alt="Logo SUAYED">
            </a>
            <a href="https://labpsiit.iztacala.unam.mx/">
                <img src="static/imagenes/Logo3.png" alt="Logo LABPSITT">
            </a>
            <a href="https://www.ipn.mx/">
                <img src="static/imagenes/Logo4.png" alt="Logo IPN">
            </a>
            <a href="https://www.escom.ipn.mx/">
                <img src="static/imagenes/Logo5.png" alt="Logo ESCOM">
            </a>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="footer-container">
            <div class="footer-text">
                <h3>¿Tienes dudas?</h3>
                <p>Si tienes más preguntas o dudas sobre cualquier tema, puedes contactarnos y seguro te responderemos.</p>
            </div>
            <div class="footer-buttons">
                <a href="mailto:serenamente@iztacala.unam.mx" class="footer-btn">Correo electrónico</a>
                <a href="avisoprivacidad.html" class="footer-btn">Aviso de Privacidad</a>
            </div>
        </div>
    </footer>

    <script>
        // Funcion para el menu de hamburguesa
        const menuToggle = document.querySelector('.menu-toggle');
        const submenu = document.querySelector('.submenu');

        menuToggle.addEventListener('click', () => {
            submenu.classList.toggle('active'); // Alterna la clase 'active' para mostrar/ocultar el menú
        });

        // Funcion que verifica el token y si se contesto el pretest
        async function verificarAutenticacion() {
            const token = localStorage.getItem("token");
            if (!token) {
                window.location.href = "/TT/login.html";
                return;
            }

            try {
                const response = await fetch("http://localhost:8002/auth/verify-token", {
                    method: "GET",
                    headers: { "Authorization": `Bearer ${token}` }
                });

                if (!response.ok) {
                    console.error("Error en la autenticación:", await response.json());
                    localStorage.removeItem("token");
                    window.location.href = "/TT/login.html";
                    return;
                }

                const userData = await response.json();
                const initials = userData.usuario.nombre
                .split(" ")
                .map(word => word[0])
                .join("")
                .toUpperCase();
                document.getElementById("user-avatar").textContent = initials;
            } catch (error) {
                console.error("Error en la autenticación:", error);
                window.location.href = "/TT/login.html";
            }
        }

        document.addEventListener("DOMContentLoaded", function () {
            const avatar = document.getElementById("user-avatar");
            const userMenu = document.querySelector(".user-menu");

            avatar.addEventListener("click", function () {
                userMenu.classList.toggle("active");
            });

            document.getElementById("logout").addEventListener("click", function () {
                localStorage.removeItem("token");
                window.location.href = "/TT/login.html";
        });

        verificarAutenticacion();
    });

    //funcion de botones 
    function startExperience() {
        document.getElementById('activities-menu').classList.remove('hidden');
        document.querySelector('.button-container').classList.add('hidden');
    }
        function postponeExperience() {
            alert('Puedes volver cuando estés listo');
            document.querySelector('.button-container').classList.add('hidden');
        }

        function startExperience() {
            document.getElementById('activities-menu').style.display = 'flex';
            document.querySelector('.button-container').style.display = 'none';
    }

    // Funcionalidad para extraer el id del token 
    function getTokenId() {
        const token = localStorage.getItem("token");
        if (token) {
            try {
                const base64Url = token.split('.')[1]; // obtiene la parte de carga del JWT
                const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                }).join(''));

                const { id } = JSON.parse(jsonPayload);
                return id;
            } catch (error) {
                console.error("Error decoding token:", error);
                return null;
            }
        }
        return null;
    }
    
    // Lógica principal: desbloquea SOLO la actividad actual
    document.addEventListener("DOMContentLoaded", async function () {
        const token = localStorage.getItem("token");
        if (!token) {
            window.location.href = "/TT/login.html";
            return;
        }

        const paciente_id = getTokenId();

        // Obtener tratamiento actual del paciente
        const tratamientoResponse = await fetch(`http://localhost:8002/tratamiento/buscar_protocolo/${paciente_id}`);
        const tratamientoData = await tratamientoResponse.json();
        const tratamiento_id = tratamientoData.id_tratamiento;

        // ID de la habilidad (puede estar fijo o dinámico según el contexto)
        const habilidad_id = 1;

        // Obtener actividades relacionadas con la habilidad
        const actividadesResponse = await fetch(`http://localhost:8002/tratamiento/ruta_actividad/${tratamiento_id}/habilidad/${habilidad_id}`);
        const actividades = await actividadesResponse.json();
        
        // Obtener la actividad actual del paciente
        const progresoResponse = await fetch(`http://localhost:8002/tratamiento/progreso/actividad_actual/${paciente_id}`);
        const progresoData = await progresoResponse.json();
        const actividadActualId = progresoData.id_actividad_actual;

        // Limpiar y mostrar actividades
        const activitiesContainer = document.querySelector(".activities");
        activitiesContainer.innerHTML = "";

        actividades.forEach((actividad, index) => {
            const activityDiv = document.createElement("div");
            activityDiv.classList.add("activity");

            const cardDiv = document.createElement("div");
            cardDiv.classList.add("activity-card");
            cardDiv.id = `activity${index + 1}`;

            const estaDesbloqueada = actividad.id_actividad === actividadActualId;
            if (actividad.id_actividad < actividadActualId) {
                cardDiv.classList.add("completada");
            } else if (actividad.id_actividad === actividadActualId) {
                // actividad actual
            } else {
                cardDiv.classList.add("disabled");
            }

            cardDiv.innerHTML = `
                <p>${index + 1}. ${actividad.nombre}</p>
                <a href="actividad${index + 1}.html">
                    <button ${actividad.id_actividad > actividadActualId ? "disabled" : ""}>
                        <img src="static/imagenes/boton0${index + 1}.png" alt="Actividad ${index + 1}">
                    </button>
                </a>
            `;

            activityDiv.appendChild(cardDiv);
            activitiesContainer.appendChild(activityDiv);
        });
    });
    </script>
</body>
</html>



















        
 
